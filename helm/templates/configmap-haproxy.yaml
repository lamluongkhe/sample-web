apiVersion: v1
kind: ConfigMap
metadata:
  name: haproxy-config
data:
  haproxy.cfg: |
    global
        log stdout format raw local0
        maxconn 4096
        nbthread 2

    defaults
        log global
        mode http
        option httplog
        timeout connect 5000ms
        timeout client 50000ms
        timeout server 50000ms

    frontend http_front
        bind *:80
        default_backend flask_back

    backend flask_back
        balance roundrobin
        option httpchk GET /
        # ⚙️ HAProxy trỏ trực tiếp tới Service flask-web trong cluster qua DNS
        server web1 flask-web.default.svc.cluster.local:80 check
        
    listen stats
        bind *:8404
        stats enable
        stats uri /haproxy?stats
        stats auth {{ .Values.haproxy.statsUser }}:{{ .Values.haproxy.statsPass }}

